---
date: 2017-04-13
layout: post
title: Æternity区块链白皮书
categories: 技术
tags: blockchain aeternity
---
## Æternity区块链白皮书
*分布式去中心化的函数式预言机*

时间：2017-02-06

版本：0.1

作者：Zackary Hess(ack@aeternity.com)、Yanislav Malahov(yani@aeternity.com)、Jack Pettersson(jack@aeternity.com)

摘要 - 自从2014年推出Ethereum(以太坊)以来，对分布式去中心化应用(智能合约)感兴趣的人越来越多，许多人尝试在区块链上构建连接真实世界数据的应用，在这过程中，我们认为在on-chain(链上)保存应用状态和代码是一种不合理的实现方式。

因此，我们提出了一种高度可扩展的区块链架构，其共识机制可以用来检查oracle(预言机)的正确性，这将使得预言机变得非常有效率，因为它避免了分层的共识机制。另外，State Channels(状态通道)概念将被集成进区块链架构中，用以提高区块链的隐私性和可扩展性，同时在状态通道中可以编写纯粹的函数式智能合约来实Tokens(代币)的转移和对预言机的访问。在此架构中，由于合约代码或应用状态不在链中保存，而是在状态通道中保存，我们可以使得智能合约在不损失实质功能的前提下，变得简单和而有效率。
	
通过这种架构，我们可以大规模，有效的实现类似代币资产和预测市场等应用。架构中某些部分的概念验证已通过Erlang语言实现，钱包、域名系统和认证系统等基本应用组件也将不久后实现。

1.介绍
    
本论文的目的是概述Æternity区块链的架构和一些可能的应用场景，将来会有更详细的论文来专门阐述共识和治理机制。需要指明的是，我们的架构设计是整体性的，所有的组件会以模块化的方式整合在一起协同工作。
	
本论文分为四个部分。首先，我们将介绍和讨论AE架构的基本理论思想。二，我们会讨论一下基础应用和一些可能的应用场景，这会给开发者提供一些思路，让他们了解如何使用本平台来开发应用。三，我们将展现用Erlang语言来实现验证AE区块链的核心概念。最后，我们作一下讨论，总结下未来可能的发展方向和与其他技术的比较。

A.前期工作
	
比特币作为区块链技术的先驱，给大家展现了一种在互联网上建立价值交换[1]的方式。在这之后又出现了多种新的技术进展：以太坊展示了一种通过区块链来实现图灵完备智能合约的方式[2]；Truthcoin在区块链上创建了可以实现预测的工具[3]；而GroupGnosis和Augur则展示了如何使预测变得更加高效[4]；Casey Detrio展示了如何在区块链上做市场[5];Namecoin(域名币)展示了如何实现分布式等价的域名服务器[6];Factom展示了如何在区块链上通过存储哈希来给数字资产作存在性证明[7]。
	
随着区块链技术的发展，其在金融和法律服务领域展现出了广阔的应用前景。但到目前为止，还没有一个完整统一的系统来实现人们所期望的景象。特别地，在当前已知的所有解决方案中，在管理性、扩展性、脚本安全性和廉价获取真实世界数据[need cit.]方面，都至少存在一个或多个方面的缺失。AE的目标就是要整合和发展这些技术，创造出一个完整统一的区块链平台。

II. ÆTERNITY BLOCKCHAIN(AE区块链)

我们认为当前“智能合约平台”缺乏可扩展性、脚本安全性和廉价连接现实世界数据的原因可以归结为三个核心问题。首先，当前盛行的有状态设计使得智能合约难以被分析，并且结合有序的交易状态使得可扩展性变得复杂[need cit.]。二，通过分布式去中心化的方式，将现实世界数据带入区块链系统的成本过于高昂，使得不少有创意的应用变得复杂而不可实现[need cit.]。三，这些平台的自我更新能力有限，无法适应新的技术和经济知识。我们认为，这三个问题中的每一个都是有切实可行的解决途径，应该深入研究和探索。

首先，最近对state channel(状态通道)技术的研究表明，对于许多应用来说，在链上保持状态是不必要的[need cit.]。通常的做法是将所有状态信息保存在状态通道中，仅使用区块链来处理信息交换后产生的资产结果，以及处理在出现争议情况下的资产回退，这为区块链架构提供了一种新的思路，图灵完备的智能合约可以通过状态通道来实现，而不需要在链上实现，这增加了可扩展性，因为所有的交易都可以被独立的和并行的处理。此外，这意味着合约永远不会写入共享状态，大大简化了去中心化应用的测试和验证。 我们认为这个设计是加强了区块链具有的金融领域特性而不是数据存储，而现有的分布式存储解决方案，可以完美的补充区块链在数据存储方面的不足。

第二，像Augur这样的应用尝试以分布式去中心化的方式，把真实世界的数据带入到区块链中-这本质上是在智能合约中建立了新的共识机制[8]，而不是利用底层区块链的共识机制来实现。 这导致其实现方式效率低下，并增加了风险。 显而易见，一种自然的实现方式是通用化底层的共识机制，使其不仅能够提供内部的状态，而且可以提供外部世界的状态。 鉴于此，有种观点认为这种共识机制可以实现对一些理论上比较复杂的结果判定，这就是oracle machine(预言机)：一个比图灵机更强大的理论机器，因为它可以回答一些无法通过计算解决的问题，比如“某场足球比赛谁能赢？“[need cit.]。
	
第三，自然地这种共识机制在运行时可以改变系统的参数，这使得它可以适应不断变化的外部条件，也可以适应新的研究和发展状况。本节的其余部分将先从帐户，代币，命名和块链结构等方面更详细的介绍AE区块链技术架构，其次描述状态通道和智能合约的实现方式，然后讨论区块链共识机制是如何用来创造一个高效的oracle mechanism(预言机制)和治理机制。 最后，我们从几个不同的角度讨论其扩展性。

A.Tokens, accounts and blocks(代币、账户和块链)

虽然智能合约的“无状态”，已经是合约开发者的一种共识，但是AE区块链仍然会对一些预定义的组件保持状态。马上我们将按照每个模块来阐述这些内容。 为了简单起见，本节假设每个节点都记录着整个块链，一些可能的优化在II-E章节中进行描述。

A.1）Access token, Aeon(使用代币，AE币)：使用区块链不是免费的，需要用户花费一个名为aeon(AE币)的代币。AE币可以用于支付平台上任何消耗资源的应用，比如在平台上实现的基础金融应用。存在与创世块中的AE币，将通过以太坊的智能合约来分发，未来AE币将通过挖矿的方式发行。平台中所有的手续费都通过AE币来支付，所有智能合约的流通媒介也是AE币。

A.2）Accounts(账户)：每个账户都包含地址、AE币余额和一个随机数，随机数的生成规则随着每笔交易和块高度而变化。同时每个账户根据开户时间必须要支付一笔小额手续费，创建和保存账户的成本用于防止垃圾数据的无限制膨胀，而删除账户回收空间则可以获得一定的奖励。

A.3）Name system(域名系统)：许多区块链系统的账户地址都是一串哈希值，对用户来说无可读性。借鉴Aaron Swartz的工作和域名币设计，AE的特性之一是拥有一个分布式又安全的域名系统，使得账户可以支持人性化的名字[9]。区块链状态中包含一个唯一性字符串到固定大小字节数组的映射，这些字符串可以用来指向帐户地址或者默克尔树的哈希。

A.4）Block Contents(块内容)：每个块包含以下组件：

* 上一个块的哈希。
* 交易的默克尔树。
* 帐户的默克尔树。
* 域名的默克尔树。
* 已开通道的默克尔树。
* 还没有回答问题的预言机的默克尔树。
* 预言机答案的默克尔树。
* 默克尔证明的默克尔树。
* 随机数发生器当前的熵。

前一个块的哈希用来维护区块链的有序性，交易树包含了当前块中的所有的交易。 除了共识投票树以外，其他所有的树都在共识机制下：如果一棵树从一个块到下一个块
之间发生了变化，那这个变化必须通过交易打包到一个新的块链交易树中，并且一个默克尔更新证明必须包含在块的证明树中。 剩下三棵树的作用，希望在接下来的章节中能够描述清楚。

B.State channels(状态通道)

在最近的区块链发展中，一个最有趣的发现是状态通道，它们在大多数情况下按照基本原则执行，只有人受交易影响时才需要去了解它。 本质上，交易方在块链上实例化一些状态，例如：一个以太坊智能合约或一个比特币多方签名。然后他们在彼此间简单的发送经过签名更新后的状态，关键点在于他们中的任何一个都可以使用这些来更新块链中的状态，虽然在大多数情况下不需要这么做。 这将使得交易各方处理交易的速度可以与信息传输一样快，而不需要等到交易已验证-最终确定-通过区块链共识机制这些流程的执行完成。

在AE区块链中，唯一需要更新的状态是AE币的转移，并且只有交易方已经存入通道中的AE币才可以被转移。 这使得所有通道彼此独立，其直接好处是任何通道中的交易都可以并行处理，极大的提高了交易吞吐量。

区块链只用于处理最终交易输出或解决所产生的冲突，这大致类似于司法系统。 不过，因为区块链的行为将是可预测的，对状态通道预期输出结果产生争议是没有益处的；恶意者也没有动力去做不正确的行为，只能在区块链的最终状态上作处理。所有这些综合起来，这将提升几个数量级的交易速度和交易量，而且保证了隐私性。

B.1）Smart Contracts(智能合约)：虽然链上唯一可以保存的状态是AE币的转移，但是AE区块链仍然有一个图灵完备的虚拟机可以运行“智能合约”。 
AE区块链上的合约是一种严格的协议，按照一些规则分配资金，与以太坊上的合约相比有一些明显的不同。两个显著的差异是，默认情况下只有双方才知道给定的合约，而且只有双方拥有开放的状态通道时才可以创建有效的合约。如果双方同意合约，他们签名并保留副本以备将来参考，只有当双方对结果产生争议时，才提交到区块链上，在这种情况下，合约代码只作为的交易的一部分保存，而不保存其他任何状态，如果争议的情况发生，区块链会根据合约来重新分配AE币，并且关闭状态通道。

```
1 macro Gold f870e8f615b386aad5b953fe089;
2
3 Gold oracle
4 if 0 1000 else 0 0 end
5 0
```
*示例1：一个简单的合约编码，可以用来对赌黄金价格，编写语言使用的是Chalang类似Forth-like语法，将在第IV-A节中介绍。*

例如，示例1显示了一个非常简单的合约，在一定时间内根据黄金的价格来打赌。 第1行，macro是宏关键字，Gold是宏的名称，后面的哈希值是预言机中问题的唯一标识，问题的内容为在2016年12月1日时如果黄金价格低于38美元/克，则这个宏的返回结果为true。合约的正文在第2-4行显示：我们首先把问题的唯一标识压入栈中，并使用预言机调用它，预言机会把答案放到栈顶部， 我们用这个答案作条件判断：如果预言机返回true，我们把0和1000放到栈中，0表示没有AE币需要被消耗，1000表示通道中有1000个AE币需要被转移给第一个参与方，反过来如果返回false，我们把0和0放到栈中，第二个0表示另一个参与方获得通道中所有的AE币，最后的0表示通道状态的随机值，在实际使用场景中，随机数将在部署时生成。

一个需要注意的重要事情是AE区块链上的智能合约不维护自己的任何状态，合约状态是由交易方维护，并在合约执行时作为输入。每个合约本质上是个纯函数，根据一些输入参数，输出新的通道状态。 一般在软件开发中，使用纯函数是有益处的，特别是在金融应用的开发过程中，这已在学术界和工业界广泛论证了数十年[10]  [need cit.]

```
1 : hashlock
2 swap
3 hash
4 == ;
```
*示例2：一个简单的哈希锁*

a）Contract interaction and multi-step contracts(合约交互和多步骤合约)：即使所有的合约是无状态的并且互相独立的执行，但仍然可以通过hashlocking(哈希锁)[need cit.]来实现合约之间的交互和状态关系。 一个简单的哈希锁如示例2，第1行，我们定义一个函数称为hashlock，给定一个哈希值h和秘密值s。 在第2行对秘密值s重新赋值，然后在第3行中对秘密值s通过hash(v)函数进行哈希运算，最后在第4行比较运算后的哈希值和原来哈希值h，如果相等，则重新赋值后的秘密值s与原来的值是一致的。通过对该函数秘密值s的控制，可以实现对不同智能合约的执行逻辑进行控制。

```
1 macro Commitment a9d7e8023f80ac8928334 ;
2
3 Commitment hashlock call
4 if 0 100 else 0 50 end
5 1
```
*示例3：哈希锁可以通过中间人来实现AE币的转移*

这个简单的例子显示，哈希锁使得不同用户在状态通道间存在一条路径，即使不共享状态通道，也可以实现AE币的转移。例如，如果Alice和Bob有一条状态通道，Bob和Carol也有一条通道，然后Alice和Carol的交易可以通过Bob来实现， 他们之间通过创建两个合约副本，每个通道一个合约副本来完成交易，见示例3，第1行的宏Commitment表示Alice所选择的秘密值的哈希，在第3行我们把它放到栈中并调用哈希锁函数，第四行条件分支的执行取决于哈希锁函数的返回值，一旦这些合约已经由各方签名，则Alice揭示秘密值，这允许Bob和Carol使用它来执行合约的条件逻辑，从而完成AE币的转移。

```
1 macro Commitment a9d7e8023f80ac8928334 ;
2
3 Commitment hashlock call
4 if State33 else State32 end
5 call
```
*示例4：一个简单的例子，使用哈希锁在通道中玩一个多方参与的游戏*

哈希锁也可以用于在状态通道中实现多方参与的游戏，见示例4，每个人都和游戏管理者建立了一条状态通道，每个通道中都包含了一个相同的智能合约，通过函State32来声明，当前我们处于游戏状态32，以及我们想要同时把所有通道中的游戏状态更新到33。当游戏管理者揭示秘密值时，所有通道中的合约将同时执行更新。

b）Metered execution(执行计量)：智能合约执行时的计量方式类似于以太坊的“gas”，但AE区块链还使用两个与其不同的资源计量，一个时间，一个是空间。 在合约被执行时，这两种资源都需要请求方使用AE币来支付。这种方式可能被认为是不可取的，因为一开始有可能是交易的另一方需要用区块链来解决争议。 但是，只要通道中的钱不都是用于投注，这个问题可以在合约代码中有效地规避，因为可以把资金从一方重新分配给另一方。 从最佳实践上来说，应该避免把所有资金放在一个通道中交易，因为它不利于同另一方交易失败后的通道关闭。

B.2）示例：让我们将所有这些想法落地。 实际上，如果Alice和Bob想在AE区块链上使用状态通道交易，他们将通过如下过程：

1）Alice和Bob签名一笔交易，指定每个人存放多少资金存放到状态通道中，并将其发布到区块链上。

2）一旦区块链打开通道，他们都可以在通道上创建新的状态，并互相发送和签名新的状态。 通道的状态可以是资金在通道中的重新分配，也可以是一个合约用于决定资金新的分配。每个通道的状态都会生成一个随机数，并由参与方签名，因此如果发生争议，一个最新的合法状态将被提交到区块链并强制执行。

3）通道可以有两种不同的方式关闭：

a）如果Alice和Bob确定他们已完成交易并达成最终的一致，他们需要同时签名并展示，然后提交到区块链，这将把通道中的资金按约定分配并关闭通道。
  
b）如果Alice因为一些原因拒绝签名关闭交易，那么Bob可以把双方最新一个已签名的状态提交到区块链用于关闭通道，这将开始一个倒计时，如果Alice认为Bob是不诚实的(其提交的状态不是最新的或者有问题)，她有机会在倒计时结束之前，把一个双方签名的拥有更高随机数的状态提交到区块链， 如果她这样做的话，通道将立即关闭，否则等倒计时结束后关闭。

C. Consensus mechanism(共识机制)

AE区块链使用Proof-of-Work和Proof-of-Stake混合共识机制。 块链的顺序性将由Proof-of-Work决定，某些系统变量将由链上的预测市场系统确定，这允许用户参与并引入他们的知识。 对于PoW算法，目前我们倾向于一种Tromp’s Cuckoo Cycle(布谷鸟循环)算法的变种，其是基于内存限制的“间接式工作量证明”，因为它只需较少的电力就可以运行，但具有其他一些限制因素，其中之一是内存延迟可用性，这种算法使得在智能手机上挖矿变得可行。

Tromp写道：
     
“[布谷鸟循环]是一种即时可验证的基于内存限制的PoW算法，它的独特之处在于延迟而不是计算。 在这个意义上说，基于布谷鸟循环的挖矿是一种ASIC开采的形式，应用在DRAM芯片上随机读写数十亿位，甚至当手机整夜充电时挖矿也不会有太多数量级的效率损失，这种不以盈利为目的碰运气的挖矿方式，使得挖矿设备的扩张前景将会非常巨大，这益于挖矿的分散化。“

预览：共识机制在AE区块链中还有一些非常规作用， 除了确认新的块以为，它也确认预言机的问题和系统参数值，特别是共识机制本身也是可以改变的。但是，应该指出的是，这并不是完全没有问题。例如，如果一个简单的工作量证明机制被使用，贿赂矿工破坏预言机将会变得低成本。 因此，AE区块链将使用工作量证明和权益证明混合算法，平衡利用两者的好处。 独立于此，PoW将被用于发行新产生的AE币。

备注：最初的意图是使用100%的权益证明算法，但是我们认为100%的PoS系统是不可能实现的。

C.1）Oracles(预言机)：这是大多数智能合约的一个关键特性，不管是以为文本还是代码形式描述，都要有能力从环境中带入价值，例如不同物品的价格或者一个特定的事件是否会发生，一个智能合约系统如果没有这种能力，本质上是个封闭的系统，可以说没有太大的用处。 这是个普遍接受的事实，并且已经有几个项目尝试将外部数据以分布式的方式带入区块链中[8]。 然而，要确定其是否可行，本质上需要在底层共识机制上面再实现一个新的共识机制。

在区块链上同时运行两个共识机制和把它们分开单独运行一样昂贵。 此外，这增加了不安全性，因为最不安全的那个将被攻击并产生“错误”值。 因此，我们建议将两个共识机制合并成一个，本质上用来确认系统状态的共识机制，也可以用来确认外部世界的状态。

这种方式通过如下工作。 任何AE币持有者都可以通过提交一个回答yes或no的问题来启动一个预言机，当这么做时，也需要指定回答这个问题的时间区间，可以是从现在开始，或者将来的某个时间。 启动预言机的用户需要在这个时间区间内按比例存放一定数量的AE币作为押金，如果有用户提交了正确可接受的答案，那么押金将会被归还，否则将会被消耗掉。区块链将为预言机生成一个唯一标识符，当它一旦可用时，可以被用来检索答案。

一旦到了需要回答问题的时间，启动预言机的用户可以免费提供一个答案。在启动预言机的用户提供了一个答案或者直到一段时间过去后，任何其他用户可以通过提交相同数量的AE币作为押金来提出反诉，如果时间到期后没有用户提出反诉，那么启动预言机用户所提供的答案将被接受，押金将归还。 如果有任何反诉被提出的话，区块链的共识机制将回答预言机的答案，这个代价会比较高，但是由于我们至少可以获得其中一笔押金，因此我们可以这么使用。

D.Governance(治理)

在过去基于区块链的系统治理一直是个很大的问题，每次系统升级都需要硬分叉，这通常会导致利益持有人之间大量的讨论，甚至在源代码中修正变量这种简单的事情。我们已经看到了涉及比特币块大小的争论，当用户的激励措施与决策制定者不一致时，统一意见变得非常困难，而且也没有明确的升级路径。我们也看到了更为复杂的治理决策，比如修复“The DAO”智能合约中的bug，这需要系统开发人员快速的干预。

这些系统的主要问题容易被识别 - 协议升级或更新的决策制定过程定义不明确且缺乏透明度。AE区块链的治理机制是共识的一部分，它使用预测市场来尽可能的达成效率性和透明性。

此外，共识机制由多个变量来定义，这些变量决定了系统的功能是什么样的以及如何被每个新块轻量化的升级，这些变量涉及从交易或者询问预言机花费的成本到修改基本参数的值，如出块时间。

通过预测市场对协议中定义的变量进行分析，用户可以学习到如何有效地改进协议。 通过预测市场对潜在的硬分叉进行分析，我们可以帮助社区达成共识，使用哪个版本的代码。每个用户为自己衡量选择最优的方式，这是种简单的默认策略，将最大化其持有的价值。

E.Scalability(扩展性)

E.1）Sharding trees(分片树)：到目前为止提出的架构是高度可扩展的,即使每个用户只保存其关心的一部分块链状态，而忽略其他用户的数据，也可以使区块链正常运行起来。新用户需要至少一个状态副本来确定他们关心的子状态，但是我们可以在任意多个节点上分割这些数据，使得每个节点的负载都尽量的小。默克尔树被用来证明一个子状态是某个状态的一部分[11]，这很容易想象出一个场景，某些节点专注于树的跟踪保存，通过插入和查找功能来获得报酬。

E.2）Light clients(轻客户端)：轻客户端不下载整个块。首先，用户给客户端一个他所关注的某个历史区块的哈希值，这种技术也被称为weak subjectivity(弱主观性)[12]。然后，客户端只知道下载包含该哈希的区块，而且只下载区块头。区块头比完整的块小得多; 只需很少的交易处理。 为了简单起见，在第II-A.4章节讨论块结构时，我们没有提到区块头，但区块头包含以下内容：
* 上一个块的散列。
* 所有状态树的根哈希。

E.3）State channels and parallelism(状态通道和并行性)：状态通道具有巨大的吞吐量，其内部的大多数交易永远不会在区块链上被执行或保存。另外，通道不会在链上写入任何共享状态，因此所有交易都可以并行处理。 鉴于目前销售的大多数消费类硬件至少有四个处理核心，因此可以提升4倍左右的交易吞吐量。

此外，从实际情况讲一般不会有复杂的并发交互场景，因此对区块链架构进行分片应该是比较容易的。 由于区块链分片技术仍然是实验性的，因此我们在AE区块链初始设计时不考虑采用任何分片技术。 但是，将来分片技术更新发展后，AE区块链应该是可以最简单的实现分片技术的区块链之一。

E.4） Transactions per second at a given memory requirement(特定内存的每秒交易量):协议的变量会被共识机制经常的更新，从其初始默认值，我们可以计算出每秒默认的交易数。

```
1 Note that this is a draft and will likely
2 change.
3
4 We define the following variables for the
following calculations:
5
6 B = block\_size in bytes
7 F = blocks\_till\_finality
8 R = time\_till\_finality in seconds
9 T = transaction size in bytes
10
11 transactions per second = B * F / (T * R)
12
13 B = 1000000 bytes = 1 megabyte per block
14 F = 24*60*2 blocks per day
15 R / F = 30 seconds per block
16 R = 24*3600 seconds per day
17 T = 1000 bytes per transaction
18
19 1000000 * 24*60*2 / 1000 / 24*3600
20 = 1000000 / 1000 / 30
21 = ca. 32 transactions per second (fast
enough to sign up every human within 8
years)
```

为了操作一个节点，我们需要保留所有块最终状态的副本，并且我们需要把块信息记录100次以上，用以防止发生攻击。 估计2天内，会有5760个块需要写入，因此需要的内存数是5760 * 1MB* 100 = 576000MB= 576GB 当没有发生攻击时，每个节点只需要存储大约5.76GB的块数据。

III. APPLICATIONS(应用)

AE区块链中无状态的智能合约使得创建应用变得简单，特别适合大批量的使用。

A. Blockchain essentials(区块链要点)

区块链的必需要素是AE币、钱包、域名和其他相关概念。把这些基础组件模块化，可以给其他应用重用和改进。

A.1）Identities(身份)：每个帐户都将拥有一个唯一ID。用户可以注册唯一的名称，并将名称链接到数据结构的Merkle-root(默克尔根)。数据结构可以包含唯一ID以及相关账户的其他信息。 我们的目标是使用Schema.org的JSON格式来表示人或公司等[13]。

A.2）Wallet(钱包)：钱包是用于与AE区块链交互的软件。 钱包管理着AE币的私钥，并创建和签名交易。 可以使用钱包发送通道交易，并在通道网络中使用应用。

A.3）Proof of existence(存在证明)：一种交易类型允许发布任何数据的哈希，系统参与者可以使用头信息来证明在该时间点存在这些数据。

B. State channel applications(状态通道应用)

状态通道中的智能合约对于需要高交易吞吐量的微服务是种完美的解决方式。

B.1）Toll API(收费API)：

当今大多数API是公开的可以供任何人调用，也有一部分API是通过用户名/密码或者令牌访问模式保护起来。支付通道运行一种新类型的API，每次使用HTTP调用请求API将支付费用。API支付调用可以解决DDOS问题，从而更容易构建高可用高质量的API。这种API对于即将到来的某些业务是至关重要的，并且在即将出现的分布式经济中扮演至关重要的角色。这为信息所有者创造了一种经济激励模式，使得他们把私有数据公开化。

B.2） Insured crowdfunding(安全众筹)：我们可以使用dominant assurance contracts(优先保障合约)[need cit.]来实现安全的众筹。一些用于公益众筹的智能合约，例如建造桥，学校或市场。

优先保障合约和传统保障合约(如Kickstarter)是不同的，因为前者对于参与者是采用优先策略。如果众筹失败，所有参与者的AE币和附带利息就会返回，因此合约保障了参与者因众筹失败导致的流动性损失。

B.3）Cross-chain atomic swaps(跨链原子互换)：跨链原子互换允许AE币和比特比之间无需信任的交换 [14],[15]。这些可以使用哈希锁来实现，锁住两个区块链上相同价值的交易。

B.4） Stable value assets and portfolio replication(稳定价值资产和资产组合复制)：我们可以使用智能合约来编程实现与现实世界中资产等值的合成资产。例如：我们创造与黄金等值的资产，合成衍生品以相等和相反对的形式存在。对于一个用户来说，拥有一个随金价变化的资产，那么一个不同的用户必须拥有与金价相反变化的资产。例如，Alice和Bob可以创建一个合约，其中Alice拥有1克黄金。合约的资金转移规则为1克黄金等值的AE币将为发送给Alice，剩余资金发送给Bob。合约有一个到期日期，到时黄金的价格将确定，然后资金将按照合约规则分发给Alice和Bob。 

B.5） Event contracts(事件合约)：当事件发生时，事件合约将支付资金，事件没有发生时，则不需要支付，这取决于预言机答案。这个特点很有趣，可以组合起来实现不同的应用：

a）Insurances(保险)：我们可以使用事件合约来实现保险，例如天气如果不好，原本价格高昂的音乐会门票将变得毫无价值。因此，如果预言机可以决定那天下雨这个事件发生后，音乐会观众可以收到一部分的补偿的话，那么投资将得到保护，人们在情感上也可以更好接受。稍微严禁一点，农民经常对一个季节的下雨量感兴趣，我们可以保障他们免受干旱时农作物减产导致的经济损失。

b）Whistleblowing(揭秘)：事件合约也可以用于激励敏感信息的揭秘。例如，我们可以打赌事件“A公司使用非法农药的信息将在2017年1月24日或之前披露”。任何知道这类信息的知情人，将会被激励去打赌事件的发生并泄漏相关信息。

B.6） Prediction markets(预测市场)：预测市场的作用是让用户打赌未来的事件是否会发生，从赌注的价格我们可以预测未来事件发生的可能性[3]，[8]，[16]，它们是以给定的价格衡量未来的最准确方式[need cit.]，一旦事件发生，市场将用预言机来结算。

如第II-D部分所述，我们可以使用预测市场来预测软件的哪些更新将是有益的，哪些是有害的。 我们也可以用来估算一个选举需要多少候选人才能完成，因此这可以更容易地发现谎言和无根据的承诺。

![](https://raw.githubusercontent.com/XiaoweiQian/note/master/img/5.png)

*示例5：多维预测市场*

a）Multidimensional prediction markets(多维预测市场)：多维预测市场使我们能够预测未来可能发生的事件之间的相关性。例如，一个人可以预测，如果Alice当选领导，马铃薯的价格会下降，如果Bob赢了，价格会上涨。一个人也可以预测，如果Google在未来3个月使用计划A，那么它可能会赚更多的钱，如果使用计划B，那么它可能会减少收入。或者，如示例5，我们可以看到，如果Alice当选总统，马铃薯价格的可能会很低。

B.7）Market with batch trading at a single price()：攻击者有两种方法可以从市场上盗窃AE币，一种是他们可以利用市场在时间上不一致，另一种是利用在空间上的不一致。

* 如果市场在空间上不一致，那么攻击者可以用来套利。 他可以同时在两个市场上交易，进行风险对冲获利。

* 如果市场时间上不一致，那么攻击者就会先于市场行动。 他可以提前获知市场将发生的交易，并在此交易发生之前或之后，进行买入和卖出获利。

![](https://raw.githubusercontent.com/XiaoweiQian/note/master/img/6.png)

*示例6：黑线是需求曲线，红线是供给曲线，红色区域的卖出量与黑色区域的买入量一样，垂直线是市场创建者选择的价格，每个人都愿意以更高的价格买入，也都愿意以更低的价格卖出。*

为了让市场在空间上一致，所有人应该使用同一个市场创建者。为了让市场在时间上一致，我们需要以每个特定价格进行批量交易。市场创建者需要向每个人承诺他决定的价格，如果有人能够从市场创建者那里找出相矛盾的价格，那么他的所有客户都应该能够取消他所有的通道。 如果市场创建者承诺了一个公平的价格，那么他将撮合相同数量的买家和卖家，如示例6显示。 否则，他将会遇到类似于示例7的情况，那样会有很大的风险。

![](https://raw.githubusercontent.com/XiaoweiQian/note/master/img/7.png)

*示例7：黑色区域远大于红色区域，市场创建者正在卖出的股份比买入还多，因此承担了很大的风险。*

IV. IMPLEMENTATION(实现)

大多数核心概念证明已经通过Erlang语言开发实现。 这包括区块链本身、合约语言、虚拟机、预言机和治理机制，以及一个旧版的共识机制。我们使用Erlang/OTP框架的原因是它可以轻松编写高并发的代码，且不容易崩溃，世界上运行时间最长的服务是基于Erlang语言开发的，它已被用于工业应用30多年，足以证明其稳定性和可靠性。

A. Virtual machine and contract language(虚拟机和合约语言)

虚拟机是基于堆栈的，类似于Forth和Bitcoin的脚本语言，但与后者相比，其特性足够丰富。 虚拟机支持函数式而非gotos语句，这使其语义相对简单且易于分析。虚拟机支持的操作码列表可以在我们的Github上找到。另外，还有一种更高级的类似Forth的语言，称为Chalang，它编译为虚拟机的字节码，它支持宏和变量名，但保持基于堆栈的执行模型[17]，Chalang代码的示例也可以在我们的Github上找到。

B. Adoption via web-integration(WEB整合)

WEB是最受欢迎的应用平台，我们将提供易于使用的Web开发工具，例如JSlibraries和JSON-APIs等用于实现AE区块链的核心功能。

C. Open source modules(开源模块)

为了容易地被私有区块链联盟和其他用例重用，相关模块将按照MIT-licensed许可编码实现，例如共识模块等，可以适用与特定需求。

D. Usability and UX design(可用性和交互设计)

良好的用户交互体验是我们开发过程中的核心重点，更具体地说，我们将清晰地确保，谁能控制身份，密钥和交易。 此外，通过网关提供方便的访问方式将是未来开发的重点，在手机交互界面上，通过类似滑动左/右的操作方式来使用预测市场，并且把简单的网络钱包通过iframe技术轻松集成到网站中将成为新的规范。

V. DISCUSSION(讨论)

我们已经说明了，如何从根本上架构一个高效率的价值转移系统。所描述的系统实际上是一个全球预言机，可以在全球范围内提供决策服务。特别地，第III章描述的应用都可以简单有效的在AE区块链上创建。

但是，我们的实现同时存在局限性和可改进点，接下来将讨论这些内容。

A. Limitations and tradeoffs(限制和权衡)

虽然我们认为通过在架构上的合理权衡，做到了在一些领域里性能上的提升，但是对于分布式应用来说，这并不是一个一站式的解决方案。它应该被视为对现有技术的增强补充，并且还有几个需要注意的事项。

A.1）On-chain state(链上状态)：尽管有许多优点，但是由于缺乏可编程状态，它不适合需要自定义状态来达成共识的应用。例如，DAOs拥有自定义域名和代币系统等不与底层资产相关联的应用。

A.2）Free option problem(自由选项问题)：

如果Alice和Bob有个通道，并且Alice已签名了合约，当Alice发送AE币给Bob时，她相当于给了Bob一个自由选择的权利：Bob可以在将来的任意一个时间点选择签名和返回(激活)。通常这不是想要的结果，为了避免这种问题，通道中的合约不能立即全部激活，他们按照时间或空间分割，参与双方将按照小的时间间隔签署合约，这样不管哪一方都不会给对方过大的选择权。

例如，如果双方想要投注100AE币，那么他们可能会分成1000次，每次只赌0.1个AE币。 这将需要大约1000次消息传递，每个方向500次，由于合约执行过程不会提交给区块链，因此这种方式是及其廉价的。另一个例子，如果一个人想创建一种持续100天的金融资产，可以每个小时签署一次，共签署2400次，这将需要大约2400个消息传递，每个方向1200个。

A.3）Liquidity loss and state channel topologies(流动性损失和状态通道拓扑)：

如第II-B.1节所示，当使用哈希锁实现组合通道时，任何中间商都必须锁定至少是通过他们发送的一倍的AE币。例如，如果Alice和Carol想通过Bob交易，Bob将扮演Carol的角色与Alice实现交互，反之亦然。

这对于Bob来说代价有点高，因此他可能收取手续费作为补偿。如果Alice和Carol期望彼此之间进行大量交易，他们可以通过创建一个新的通道来避免这种情况，并通过哈希锁将合约转移到新通道。

然而，由于保持额外的通道开放，会对流动性造成负面影响，在许多情况下，通过中间商也是可行的，特别是交易双方预计未来不会有很大的交易量的情况下。 因此，可能会出现一种通道拓扑，有钱用户通过它来实现与其他用户的去中心化交易。

应该指出的是，这并不构成单点故障，因为我们不信任这些交易发送者。 如果在一个哈希锁的秘密被揭示之前，发送者离线已经离线，则交易不会通过。 如果在之后离线，唯一可能的“负面”效应是发送者无法认领它的AE币。

B. Future work(未来工作)

有几种可能的方法来改进当前架构。

B.1）Functional contract language(函数式合约语言)：

一个合理的方向是未来试验更高级的语言，更接近与函数式范式。跟踪隐式堆栈通常是容易出错的，并且可能不适合高级别的开发人员，而使用函数式语言开发合约是相当容易的，这大大简化了合约的开发和验证。如果这样做，虚拟机将与新语言紧密的结合在一起，使编译降低出错率，并且减少开发人员的依赖性。 理想的情况是，从表面语言到虚拟机代码的翻译只需要直接转录，这种方式已经过同行间的评审和研究，但仍做出了一些务实性的让步。

B.2）Multi-party channels(多方通道)：

目前，所有通道都仅限于双方，虽然多方通道可以通过哈希锁来实现，但这代价有点高。 因此，我们计划研究一种支持n-party(多方)的通道，适用与m-of-n的结算机制。

GLOSSARY(词汇表)

Blockchain(区块链)：具有计量访问功能的分布式防篡改数据库。 数据库由逐渐增长的哈希链块定义，并且可以有附加任何规则。

Aeon(AE币)：一个AE币代表帐户的基本单位和它拥有AE区块链的访问权，它可以被转让。

Transaction(交易)：从用户发送给区块链的消息，说明用户如何使用其货币来访问区块链。

State Channel(状态通道)：记录在块上的两个用户之间的关系，它使用户能够来回发送AE币，并在用户之间创建由区块链强制结算的去中心化智能合约。

Hash(哈希)：哈希对于一个任何大小的二进制输入，都能给定一个固定大小的输出，相同的输入始终有相同的输出，不能从输出反向推导出输入。

Hashlocking(哈希锁)：这是我们如何连接成对的通道，创建涉及2人以上的智能合约的机制。 一个秘密被哈希引用后，当秘密被揭示时，它可以同时更新多个通道。

Governance(治理)：一个明确的过程，为未来的区块链协议的变化做出决策。

Oracle(预言机)：一种机制，告诉区块链我们所处的现实世界，使用预言机，用户可以预测事件的结果。

Value-Holder(价值持有人)：拥有AE币或系统中金融衍生工具的用户。

Validator(验证者)：验证者是参与共识机制的用户，在AE区块链中，每个价值持有者都可以参与。

ACKNOWLEDGMENTS(致谢)

感谢Vlad，Matt，Paul，Dirk，Martin，Alistair，Devon和Ben的校对阅读,感谢能和他们以及许多其他人的深度讨论。

REFERENCES(引用)

[1] S. Nakamoto, “Bitcoin: A peer-to-peer electronic cash system,” 2008. [Online]. Available: https://bitcoin.org/bitcoin.pdf.

[2] V. Buterin, “Ethereum: A next-generation smart contract and decentralized application platform,” 2014.[Online]. Available: https://github.com/ethereum/wiki/wiki/White-Paper.

[3] P. Sztorc, “Market empiricism,” [Online]. Available: http://bitcoinhivemind.com/papers/1_Purpose.pdf.

[4] M. Liston and M. Koppelmann, “A visit to the oracle,” 2016. [Online]. Available: https://blog.gnosis.pm.

[5] C. Detrio, “Smart markets for smart contracts,” 2015.[Online]. Available: http://cdetr.io/smartmarkets/.

[6] Namecoin wiki, 2016. [Online]. Available: https://wiki.namecoin.org/index.php?title=Welcome.

[7] P. Snow, B. Deery, J. Lu, et al., “Factom: Business processes secured by immutable audit trails on the blockchain,” 2014. [Online]. Available: http://bravenewcoin.com/assets/Whitepapers/Factom-Whitepaper.pdf.

[8] J. Peterson and J. Krug, “Augur: A decentralized,open-source platform for prediction markets,” 2014.[Online]. Available: http://bravenewcoin.com/assets/Whitepapers/Augur-A-Decentralized-Open-Source-Platformfor-Prediction-Markets.pdf.

[9] A. Swartz, “Squaring the triangle: Secure, decentralized,human-readable names,” 2011. [Online]. Available:http://www.aaronsw.com/weblog/squarezooko.

[10] T. Hvitved, “A Survey of Formal Languages for Contracts,” in Formal Languages and Analysis of Contract-Oriented Software, 2010, pp. 29–32. [Online].Available: http:// www.diku.dk/hjemmesider/ansatte/hvitved/publications/hvitved10flacosb.pdf.

[11] R. C. Merkle, “Protocols for public key cryptosystems,”in IEEE Symposium on Security and Privacy,1980.

[12] V. Buterin, “Proof of stake: How I learned to love weak subjectivity,” 2014. [Online]. Available: https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/.

[13] “Schema.org schemas,” 2016. [Online]. Available:http://schema.org/docs/schemas.html.

[14] “Atomic-cross-chain-trading,” 2016. [Online]. Available:https://en.bitcoin.it/wiki/Atomic%5C_cross-chain%5C_trading.

[15] “Interledger,” 2016. [Online]. Available: https://interledger.org/.

[16] K. J. Arrow, R. Forsythe, M. Gorham, et al., “Thepromise of prediction markets,” Science, 320 2008.[Online]. Available: http://mason.gmu.edu/˜rhanson/PromisePredMkt.pdf.

[17] Z. Hess, “Chalang,” 2016. [Online]. Available:https://github.com/aeternity/chalang.

End

原文：https://blockchain.aeternity.com/%C3%A6ternity-blockchain-whitepaper.pdf

编译：Qian Xiaowei(barakawei@me.com)
